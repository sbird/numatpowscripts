import matplotlib
matplotlib.use("PDF")
import re
import sys
import numpy as np
import os.path as path
from save_figure import save_figure
import math
import matplotlib.pyplot as plt
import neutrinoplot as neu
import plot_mat_pow as pmat
import plot_flux_pow as pflux
datadir="/home/spb/data/new-kspace/yacine-kspace"
partdir="/home/spb/data/new-kspace/part"
outdir="/home/spb/papers/fs-neutrino/plots"
neut=neu.neutrino_power(data=datadir, matpow=datadir+"/b512p512nu0.3z49/")

plt.figure()

def plot_nu_powers(num_str, zz, directory,shot):
    #High-redshift
    pmat.plot_nu_folded_power(path.join(datadir,directory+"/powerspec_nu_"+num_str+".txt"),ls="-",color="black")
    try:
        pmat.plot_nu_power(path.join(datadir,directory+"/ics_matterpow_"+zz+".dat"),ls=":")
    except Exception:
        pass
    (k,delta)=pmat.get_folded_power(path.join(partdir,directory+"/powerspec_type2_"+num_str+".txt"))
#     plt.loglog(k,delta-(256./shot)**3/(2*math.pi**2)*np.ones(np.size(delta)),ls="--")
    plt.loglog(k,delta,ls="--",color="red")
    #Plot delta = 1.
#     xx=np.arange(1e-3,100)
    #This is delta=1
#     plt.loglog(xx,np.ones(np.size(xx))/xx**3,color="grey",ls=":")
    #This is the shot limit
#     plt.loglog(xx,np.ones(np.size(xx))*(256./shot)**3/(2*math.pi**2),color="grey",ls=":")
    plt.xlim(1e-2,10)

#Simple plot to test addition
plt.clf()
fnu = 0.02280553/(1.01800688+0.02280553)
(kk, ddnu)=pmat.get_folded_power(path.join(partdir,"b256p512nu0.3z49"+"/powerspec_type2_001.txt"))
(kk, ddcdm)=pmat.get_folded_power(path.join(partdir,"b256p512nu0.3z49"+"/powerspec_type1_001.txt"))
(kk, ddtot)=pmat.get_folded_power(path.join(partdir,"b256p512nu0.3z49"+"/powerspec_001.txt"))
(k2, yynu)=pmat.get_nu_folded_power(path.join(datadir,"b256p512nu0.3z49"+"/powerspec_nu_001.txt"))
yynu=pmat.rebin(yynu,k2,kk)
(kk, yycdm)=pmat.get_folded_power(path.join(datadir,"b256p512nu0.3z49"+"/powerspec_type1_001.txt"))
(kk, yytot)=pmat.get_folded_power(path.join(datadir,"b256p512nu0.3z49"+"/powerspec_001.txt"))
shot=(256./512)**3/(2*math.pi**2)*np.ones(np.size(yynu))
# plt.semilogx(kk,((1-fnu)*np.sqrt(ddcdm)+fnu*np.sqrt(ddnu))**2/ddtot,color="grey")
plt.semilogx(kk,((1-fnu)*np.sqrt(yycdm)+fnu*np.sqrt(yynu))**2/yytot,color="black")
plt.semilogx(kk,yycdm/ddcdm,color="red")
(kk, ddcdm0)=pmat.get_folded_power(path.join(partdir,"b256p512nu0.3z49"+"/powerspec_type1_000.txt"))
(kk, yycdm0)=pmat.get_folded_power(path.join(datadir,"b256p512nu0.3z49"+"/powerspec_type1_000.txt"))
plt.semilogx(kk,yycdm0/ddcdm0,color="blue")
# (kk, yycdm)=pmat.get_folded_power(path.join(datadir,"b256p512nu0.3z49triple"+"/powerspec_type1_000.txt"))
# (kk, ddcdm)=pmat.get_folded_power(path.join(partdir,"b256p512nu0.3z49"+"/powerspec_type1_000.txt"))
# plt.semilogx(kk,(yynu+shot)/ddnu,color="blue")
plt.semilogx(kk,yytot/ddtot,color="green")
plt.tight_layout()
save_figure(path.join(outdir,"M_test"))

plt.clf()
pmat.plot_nu_folded_power(path.join(datadir,"b256p512nu0.3z49/powerspec_nu_008.txt"),ls="-",color="black")
pmat.plot_nu_power(path.join(datadir,"b256p512nu0.3z49/ics_matterpow_0.dat"),ls=":",color="green")
# (kk, dd)=pmat.get_folded_power(path.join(partdir,"b256p512nu0.3z49noshot"+"/powerspec_type2_008.txt"))
# plt.loglog(kk,dd-(256/512.)**3/(2*math.pi**2)*np.ones(np.size(dd)))
# pmat.plot_folded_power(path.join(partdir,'b256p1024nu0.3z49'+"/powerspec_008.txt"))
# pmat.plot_power(path.join(datadir,'b256p1024nu0.3z49'+"/ics_matterpow_0.dat"))
(kk, dd)=pmat.get_folded_power(path.join(partdir,"b256p1024nu0.3z49"+"/powerspec_type2_008.txt"))
plt.loglog(kk,dd,ls="--",color="red")
plt.loglog(0.2*np.ones(np.size(np.arange(1e-10,1e4))),np.arange(1e-10,1e4),color="grey",ls="--")
# pmat.plot_nu_folded_power(path.join(datadir,"b256p512nu0.3z49double"+"/powerspec_nu_008.txt"))
xx=np.arange(0.001,1000,100)
# plt.loglog(xx,np.ones(np.size(xx))*(256./512)**3/(2*math.pi**2),color="grey",ls=":")
plt.ylim(1e-9,1000)
plt.xlim(1e-2,10)
plt.xlabel("k /(h Mpc-1)")
plt.ylabel(r"$\mathrm{P}_\nu(k)$ (Mpc/h)$^3$")
plt.tight_layout()
save_figure(path.join(outdir,"P_nu_M03_z0"))

#plt.clf()
#plot_nu_powers('006','0.5','b256p512nu0.3z49',512)
## (kk, dd)=pmat.get_folded_power(path.join(partdir,"b256p512nu0.3z49"+"/powerspec_type2_006.txt"))
## plt.loglog(kk,dd-(256/512.)**3/(2*math.pi**2)*np.ones(np.size(dd)))
#plt.ylim(1e-9,1000)
#plt.xlabel("k /(h Mpc-1)")
#plt.ylabel("P(k) (Mpc/h)$^3$")
#plt.tight_layout()
#save_figure(path.join(outdir,"P_nu_M03_z0_5"))
#
#plt.clf()
#plot_nu_powers('007','0.2','b256p512nu0.3z49',512)
## (kk, dd)=pmat.get_folded_power(path.join(partdir,"b256p512nu0.3z49"+"/powerspec_type2_007.txt"))
## plt.loglog(kk,dd-(256/512.)**3/(2*math.pi**2)*np.ones(np.size(dd)))
#plt.ylim(1e-9,1000)
#plt.xlabel("k /(h Mpc-1)")
#plt.ylabel("P(k) (Mpc/h)$^3$")
#plt.tight_layout()
#save_figure(path.join(outdir,"P_nu_M03_z0_2"))

#Make ratios
plt.clf()
(k,delta_m_l) = pmat.get_power(path.join(datadir,'b256p512nu0.3z49'+"/ics_matterpow_0.dat"))
(kn,delta_nu_l) = pmat.get_nu_power(path.join(datadir,'b256p512nu0.3z49'+"/ics_matterpow_0.dat"))
plt.loglog(k,delta_nu_l/delta_m_l,ls="--")
(kfn,delta_nu)=pmat.get_nu_folded_power(path.join(datadir,'b256p512nu0.3z49'+"/powerspec_nu_008.txt"))
(kfnp,delta_nu_p)=pmat.get_folded_power(path.join(partdir,'b256p512nu0.3z49'+"/powerspec_type2_008.txt"))
(kf,delta_m)=pmat.get_folded_power(path.join(datadir,'b256p512nu0.3z49'+"/powerspec_008.txt"))
plt.loglog(kf,pmat.rebin(delta_nu,kfn,kf)/delta_m,ls="-")
plt.loglog(kf,pmat.rebin(delta_nu_p-(256/512.)**3/(2*math.pi**2)*np.ones(np.size(kfnp)),kfnp,kf)/delta_m,ls="-")
plt.xlim(1e-2,100)
plt.ylim(1e-11,1)
save_figure(path.join(outdir,"P_ratios_z0"))


plt.clf()
pmat.plot_nu_folded_power(path.join(datadir,"b256p512nu0.3z49/powerspec_nu_005.txt"),ls="-",color="black")
pmat.plot_nu_power(path.join(datadir,"b256p512nu0.3z49/ics_matterpow_1.dat"),ls=":",color="green")
#pmat.plot_folded_power(path.join(partdir,'b60p512nu0.3z49'+"/powerspec_type2_012.txt"))
# (kk, dd)=pmat.get_folded_power(path.join(partdir,"b60p512nu0.3z49"+"/powerspec_type2_012.txt"))
# plt.loglog(kk,dd-(60/512.)**3/(2*math.pi**2)*np.ones(np.size(dd)))
# (kk, dd)=pmat.get_nu_folded_power(path.join(datadir,"b256p512nu0.3z49double"+"/powerspec_nu_005.txt"))
# plt.loglog(kk,dd)
(kk, dd)=pmat.get_folded_power(path.join(partdir,"b256p1024nu0.3z49"+"/powerspec_type2_005.txt"))
plt.loglog(kk,dd,ls="--",color="red")
# plt.loglog(kk,dd-(256/1024.)**3/(2*math.pi**2)*np.ones(np.size(dd)))
plt.loglog(0.4*np.ones(np.size(np.arange(1e-12,1e4))),np.arange(1e-12,1e4),color="grey",ls="--")
plt.ylim(1e-9,1000)
plt.xlim(1e-2,10)
plt.xlabel("k /(h Mpc-1)")
plt.ylabel(r"$\mathrm{P}_\nu(k)$ (Mpc/h)$^3$")
plt.tight_layout()
save_figure(path.join(outdir,"P_nu_M03_z1"))

plt.clf()
plot_nu_powers('002','4','b256p512nu0.3z49',512)
#pmat.plot_folded_power(path.join(partdir,'b60p512nu0.3z49'+"/powerspec_type2_001.txt"))
(kk, dd)=pmat.get_folded_power(path.join(partdir,"b60p512nu0.3z49"+"/powerspec_type2_001.txt"))
# plt.loglog(kk,dd-(60/512.)**3/(2*math.pi**2)*np.ones(np.size(dd)))
plt.loglog(kk,dd,ls="--")
plt.loglog(np.ones(np.size(np.arange(1e-12,1e4))),np.arange(1e-12,1e4),color="grey",ls="--")
plt.ylim(1e-11,1000)
plt.xlabel("k /(h Mpc-1)")
plt.ylabel("P(k) (Mpc/h)$^3$")
plt.tight_layout()
save_figure(path.join(outdir,"P_nu_M03_z4"))

plt.clf()
plot_nu_powers('004','2','b256p512nu0.3z49',512)
#pmat.plot_folded_power(path.join(partdir,'b60p512nu0.3z49'+"/powerspec_type2_001.txt"))
(kk, dd)=pmat.get_folded_power(path.join(partdir,"b60p512nu0.3z49"+"/powerspec_type2_011.txt"))
# plt.loglog(kk,dd-(60/512.)**3/(2*math.pi**2)*np.ones(np.size(dd)))
plt.loglog(kk,dd,ls="--")
plt.loglog(np.ones(np.size(np.arange(1e-12,1e4))),np.arange(1e-12,1e4),color="grey",ls="--")
plt.ylim(1e-11,1000)
plt.xlabel("k /(h Mpc-1)")
plt.ylabel("P(k) (Mpc/h)$^3$")
plt.tight_layout()
save_figure(path.join(outdir,"P_nu_M03_z2"))


plt.clf()
plot_nu_powers('003','3','b256p512nu0.3z49',512)
#pmat.plot_folded_power(path.join(partdir,'b60p512nu0.3z49'+"/powerspec_type2_001.txt"))
(kk, dd)=pmat.get_folded_power(path.join(partdir,"b60p512nu0.3z49"+"/powerspec_type2_006.txt"))
# plt.loglog(kk,dd-(60/512.)**3/(2*math.pi**2)*np.ones(np.size(dd)))
plt.loglog(kk,dd,ls="-.")
plt.loglog(np.ones(np.size(np.arange(1e-12,1e4))),np.arange(1e-12,1e4),color="grey",ls="--")
plt.ylim(1e-11,1000)
plt.xlabel("k /(h Mpc-1)")
plt.ylabel("P(k) (Mpc/h)$^3$")
plt.tight_layout()
save_figure(path.join(outdir,"P_nu_M03_z3"))

#High-redshift
#Total matter power comparison plots
plt.clf()
#High-redshift
#Change the 512 part back to a 1024 when done.
neut.plot_directory(["/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.3z49/","/home/spb/data/new-kspace/part/b256p512nu0.3z49/","/home/spb/data/new-kspace/yacine-kspace/b256p1024nu0.3z49/"],redshifts=3,lssin=["-","--","-"],coloursin=["blue","red","green"])
plt.xlim(1e-2,10)
plt.ylim(0.7,1)
save_figure(path.join(outdir,"P_tot_M03_z3"))

#Total matter power comparison plots
plt.clf()
#High-redshift
neut.plot_directory(["/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.3z49/","/home/spb/data/new-kspace/part/b256p512nu0.3z49/","/home/spb/data/new-kspace/yacine-kspace/b256p1024nu0.3z49/"],redshifts=1,lssin=["-","--","-"],coloursin=["blue","red","green"])
plt.xlim(1e-2,10)
plt.ylim(0.7,1)
save_figure(path.join(outdir,"P_tot_M03_z1"))

#Low-redshift
plt.clf()
neut.plot_directory(["/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.3z49/","/home/spb/data/new-kspace/part/b256p512nu0.3z49/"],redshifts=0,lssin=["-","--","-"],coloursin=["blue","red","green"])
plt.xlim(1e-2,10)
plt.ylim(0.7,1)
plt.title("")
plt.tight_layout()
save_figure(path.join(outdir,"P_tot_M03_z0"))

##M_nu = 0.15

plt.clf()
plot_nu_powers('008','0','b256p512nu0.15z49',512)
plt.ylim(1e-9,1000)
plt.xlabel("k /(h Mpc-1)")
plt.ylabel("P(k) (Mpc/h)$^3$")
plt.tight_layout()
save_figure(path.join(outdir,"P_nu_M015_z0"))

#plt.clf()
#plot_nu_powers('006','0.5','b256p512nu0.15z49',512)
#plt.ylim(1e-9,1000)
#plt.xlabel("k /(h Mpc-1)")
#plt.ylabel("P(k) (Mpc/h)$^3$")
#plt.tight_layout()
#save_figure(path.join(outdir,"P_nu_M015_z0_5"))

plt.clf()
plot_nu_powers('005','1','b256p512nu0.15z49',512)
plt.ylim(1e-9,1000)
plt.xlabel("k /(h Mpc-1)")
plt.ylabel("P(k) (Mpc/h)$^3$")
plt.tight_layout()
save_figure(path.join(outdir,"P_nu_M015_z1"))

##M_nu = 0.45
plt.clf()
plot_nu_powers('008','0','b256p512nu0.45z49',512)
plt.ylim(1e-9,1000)
plt.xlabel("k /(h Mpc-1)")
plt.ylabel("P(k) (Mpc/h)$^3$")
plt.tight_layout()
save_figure(path.join(outdir,"P_nu_M045_z0"))

#M_nu = 0.6
plt.clf()
plot_nu_powers('008','0','b256p512nu1.2z99',512)
pmat.plot_nu_power("/home/spb/data/new-kspace/old-kspace/b256p512nu1.2z99/CAMB_TABLES/tab_matterpow_0.dat",ls="-")
pmat.plot_power("/home/spb/data/new-kspace/old-kspace/b256p512nu1.2z99/CAMB_TABLES/tab_matterpow_0.dat")
pmat.plot_nu_power("/home/spb/data/new-kspace/old-kspace/b256p512nu1.2z99/CAMB_TABLES/tab_matterpow_0.110899653824242.dat",ls="-")
plt.ylim(1e-9,1000)
plt.xlabel("k /(h Mpc-1)")
plt.ylabel("P(k) (Mpc/h)$^3$")
plt.tight_layout()
save_figure(path.join(outdir,"P_nu_M12_z0"))

#M_nu = 0.6
plt.clf()
plot_nu_powers('005','1','b256p512nu1.2z99',512)
plt.ylim(1e-9,1000)
plt.xlabel("k /(h Mpc-1)")
plt.ylabel("P(k) (Mpc/h)$^3$")
plt.tight_layout()
save_figure(path.join(outdir,"P_nu_M12_z1"))

#M_nu = 0.6
plt.clf()
plot_nu_powers('008','0','b256p512nu0.6z99',512)
plt.ylim(1e-9,1000)
plt.xlabel("k /(h Mpc-1)")
plt.ylabel("P(k) (Mpc/h)$^3$")
plt.tight_layout()
save_figure(path.join(outdir,"P_nu_M06_z0"))

#M_nu = 0.6
plt.clf()
plot_nu_powers('005','1','b256p512nu0.6z99',512)
plt.ylim(1e-9,1000)
plt.xlabel("k /(h Mpc-1)")
plt.ylabel("P(k) (Mpc/h)$^3$")
plt.tight_layout()
save_figure(path.join(outdir,"P_nu_M06_z1"))

#M_nu = 0.6
plt.clf()
plot_nu_powers('006','0.5','b256p512nu0.6z99',512)
plt.ylim(1e-9,1000)
plt.xlabel("k /(h Mpc-1)")
plt.ylabel("P(k) (Mpc/h)$^3$")
plt.tight_layout()
save_figure(path.join(outdir,"P_nu_M06_z0_5"))

#M_nu = 0.6
plt.clf()
plot_nu_powers('007','0.2','b256p512nu0.6z99',512)
plt.ylim(1e-9,1000)
plt.xlabel("k /(h Mpc-1)")
plt.ylabel("P(k) (Mpc/h)$^3$")
plt.tight_layout()
save_figure(path.join(outdir,"P_nu_M06_z0_2"))

plt.clf()
plot_nu_powers('007','0.2','b256p512nu0.45z49',512)
plt.ylim(1e-9,1000)
plt.xlabel("k /(h Mpc-1)")
plt.ylabel("P(k) (Mpc/h)$^3$")
plt.tight_layout()
save_figure(path.join(outdir,"P_nu_M045_z0_2"))

plt.clf()
plot_nu_powers('006','0.5','b256p512nu0.45z49',512)
plt.ylim(1e-9,1000)
plt.xlabel("k /(h Mpc-1)")
plt.ylabel("P(k) (Mpc/h)$^3$")
plt.tight_layout()
save_figure(path.join(outdir,"P_nu_M045_z0_5"))

plt.clf()
plot_nu_powers('005','1','b256p512nu0.45z49',512)
plt.ylim(1e-9,1000)
plt.xlabel("k /(h Mpc-1)")
plt.ylabel("P(k) (Mpc/h)$^3$")
plt.tight_layout()
save_figure(path.join(outdir,"P_nu_M045_z1"))

#Total matter power comparison plots
plt.clf()
neut.plot_directory(["/home/spb/data/new-kspace/part/b256p512nu0.15z49/","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.15z49/","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.15z99/"],redshifts=1,lssin=["--",":","-"],coloursin=["blue","red","green"])
plt.xlim(1e-2,10)
# plt.ylim(0.85,1)
save_figure(path.join(outdir,"P_tot_M015_z1"))

#Total matter power comparison plots
plt.clf()
neut.plot_directory(["/home/spb/data/new-kspace/part/b256p512nu0.15z49/","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.15z49/","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.15z99/"],redshifts=0,lssin=["--",":","-"],coloursin=["blue","red","green"])
plt.xlim(1e-2,10)
# plt.ylim(0.85,1)
save_figure(path.join(outdir,"P_tot_M015_z0"))

#0.45
plt.clf()
neut.plot_directory(["/home/spb/data/new-kspace/part/b256p512nu0.45z49/","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.45z49/"],redshifts=1,lssin=["--","-","-"],coloursin=["blue","red","green"])
plt.xlim(1e-2,10)
plt.ylim(0.5,1)
save_figure(path.join(outdir,"P_tot_M045_z1"))

plt.clf()
neut.plot_directory(["/home/spb/data/new-kspace/part/b256p512nu0.45z49/","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.45z49/"],redshifts=0,lssin=["--","-","-"],coloursin=["blue","red","green"])
plt.xlim(1e-2,10)
plt.ylim(0.5,1)
save_figure(path.join(outdir,"P_tot_M045_z0"))

#0.45
plt.clf()
neut.plot_directory(["/home/spb/data/new-kspace/part/b256p512nu1.2z99/","/home/spb/data/new-kspace/old-kspace/b256p512nu1.2z99/"],redshifts=1,lssin=["--","-","-"],coloursin=["blue","red","green"])
plt.xlim(1e-2,10)
plt.ylim(0.1,1)
save_figure(path.join(outdir,"P_tot_M12_z1"))

plt.clf()
neut.plot_directory(["/home/spb/data/new-kspace/part/b256p512nu1.2z99/","/home/spb/data/new-kspace/old-kspace/b256p512nu1.2z99/"],redshifts=0,lssin=["--","-","-"],coloursin=["blue","red","green"])
plt.xlim(1e-2,10)
plt.ylim(0.1,1)
save_figure(path.join(outdir,"P_tot_M12_z0"))

plt.clf()
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/part/b256p512nu0.45z49/powerspec_008.txt","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.45z49/powerspec_008.txt",ls="-",colour="black")
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/part/b256p512nu0.45z49/powerspec_005.txt","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.45z49/powerspec_005.txt",ls="--",colour="blue")
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/part/b256p512nu0.45z49/powerspec_003.txt","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.45z49/powerspec_003.txt",ls=":",colour="grey")
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/part/b256p512nu0.45z49/powerspec_001.txt","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.45z49/powerspec_001.txt",ls="-.",colour="green")
plt.xlim(0.02,6)
plt.ylim(-0.3,0.3)
plt.title(r"$M_\nu = 0.45$ eV")
save_figure(path.join(outdir,"P_tot_rel_M045"))

plt.clf()
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/part/b256p512nu0.6z99/powerspec_008.txt","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.6z99/powerspec_008.txt",ls="-",colour="black")
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/part/b256p512nu0.6z99/powerspec_005.txt","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.6z99/powerspec_005.txt",ls="--",colour="blue")
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/part/b256p512nu0.6z99/powerspec_003.txt","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.6z99/powerspec_003.txt",ls=":",colour="grey")
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/part/b256p512nu0.6z99/powerspec_001.txt","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.6z99/powerspec_001.txt",ls="-.",colour="green")
plt.xlim(0.02,6)
plt.ylim(-0.3,0.3)
plt.title(r"$M_\nu = 0.6$ eV")
save_figure(path.join(outdir,"P_tot_rel_M06"))

plt.clf()
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/part/b256p512nu1.2z99/powerspec_008.txt","/home/spb/data/new-kspace/yacine-kspace/b256p512nu1.2z99/powerspec_008.txt",ls="-",colour="black")
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/part/b256p512nu1.2z99/powerspec_005.txt","/home/spb/data/new-kspace/yacine-kspace/b256p512nu1.2z99/powerspec_005.txt",ls="--",colour="blue")
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/part/b256p512nu1.2z99/powerspec_003.txt","/home/spb/data/new-kspace/yacine-kspace/b256p512nu1.2z99/powerspec_003.txt",ls=":",colour="grey")
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/part/b256p512nu1.2z99/powerspec_001.txt","/home/spb/data/new-kspace/yacine-kspace/b256p512nu1.2z99/powerspec_001.txt",ls="-.",colour="green")
plt.xlim(0.02,6)
plt.ylim(-1.5,1.5)
plt.title(r"$M_\nu = 1.2$ eV")
save_figure(path.join(outdir,"P_tot_rel_M12"))

plt.clf()
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/part/b256p512nu0.6z99/powerspec_008.txt","/home/spb/data/new-kspace/old-kspace/b256p512nu0.6z99/powerspec_008.txt",ls="-",colour="black")
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/part/b256p512nu0.6z99/powerspec_007.txt","/home/spb/data/new-kspace/old-kspace/b256p512nu0.6z99/powerspec_007.txt",ls="-",colour="red")
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/part/b256p512nu0.6z99/powerspec_006.txt","/home/spb/data/new-kspace/old-kspace/b256p512nu0.6z99/powerspec_006.txt",ls="-",colour="yellow")
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/part/b256p512nu0.6z99/powerspec_005.txt","/home/spb/data/new-kspace/old-kspace/b256p512nu0.6z99/powerspec_005.txt",ls="--",colour="blue")
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/part/b256p512nu0.6z99/powerspec_003.txt","/home/spb/data/new-kspace/old-kspace/b256p512nu0.6z99/powerspec_003.txt",ls=":",colour="grey")
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/part/b256p512nu0.6z99/powerspec_001.txt","/home/spb/data/new-kspace/old-kspace/b256p512nu0.6z99/powerspec_001.txt",ls="-.",colour="green")
plt.xlim(0.02,6)
# plt.ylim(-0.3,0.3)
plt.title(r"$M_\nu = 0.6$ eV")
save_figure(path.join(outdir,"P_tot_oldkspace_M06"))

plt.clf()
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/part/b256p512nu1.2z99/powerspec_008.txt","/home/spb/data/new-kspace/old-kspace/b256p512nu1.2z99/powerspec_008.txt",ls="-",colour="black")
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/part/b256p512nu1.2z99/powerspec_007.txt","/home/spb/data/new-kspace/old-kspace/b256p512nu1.2z99/powerspec_007.txt",ls="-",colour="red")
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/part/b256p512nu1.2z99/powerspec_006.txt","/home/spb/data/new-kspace/old-kspace/b256p512nu1.2z99/powerspec_006.txt",ls="-",colour="yellow")
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/part/b256p512nu1.2z99/powerspec_005.txt","/home/spb/data/new-kspace/old-kspace/b256p512nu1.2z99/powerspec_005.txt",ls="--",colour="blue")
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/part/b256p512nu1.2z99/powerspec_003.txt","/home/spb/data/new-kspace/old-kspace/b256p512nu1.2z99/powerspec_003.txt",ls=":",colour="grey")
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/part/b256p512nu1.2z99/powerspec_001.txt","/home/spb/data/new-kspace/old-kspace/b256p512nu1.2z99/powerspec_001.txt",ls="-.",colour="green")
plt.xlim(0.02,6)
plt.ylim(-5,5)
plt.title(r"$M_\nu = 1.2$ eV")
save_figure(path.join(outdir,"P_tot_oldkspace_M12"))

plt.clf()
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/part/b256p512nu0.3z49/powerspec_008.txt","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.3z49/powerspec_008.txt",ls="-",colour="black")
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/part/b256p512nu0.3z49/powerspec_005.txt","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.3z49/powerspec_005.txt",ls="--",colour="blue")
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/part/b256p512nu0.3z49/powerspec_003.txt","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.3z49/powerspec_003.txt",ls=":",colour="grey")
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/part/b256p512nu0.3z49/powerspec_001.txt","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.3z49/powerspec_001.txt",ls="-.",colour="green")
plt.xlim(0.02,6)
plt.ylim(-0.3,0.3)
plt.title(r"$M_\nu = 0.3$ eV")
save_figure(path.join(outdir,"P_tot_rel_M03"))

plt.clf()
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/part/b256p512nu0.15z49/powerspec_008.txt","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.15z49/powerspec_008.txt",ls="-",colour="black")
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/part/b256p512nu0.15z49/powerspec_005.txt","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.15z49/powerspec_005.txt",ls="--",colour="blue")
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/part/b256p512nu0.15z49/powerspec_003.txt","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.15z49/powerspec_003.txt",ls=":",colour="grey")
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/part/b256p512nu0.15z49/powerspec_001.txt","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.15z49/powerspec_001.txt",ls="-.",colour="green")
plt.xlim(0.02,6)
plt.ylim(-0.3,0.3)
plt.title(r"$M_\nu = 0.15$ eV")
save_figure(path.join(outdir,"P_tot_rel_M015"))

plt.clf()
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.15z99/powerspec_008.txt","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.15z49fh/powerspec_008.txt",ls="-",colour="black")
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.15z99/powerspec_005.txt","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.15z49fh/powerspec_005.txt",ls="--",colour="blue")
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.15z99/powerspec_003.txt","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.15z49fh/powerspec_003.txt",ls=":",colour="grey")
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.15z99/powerspec_001.txt","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.15z49fh/powerspec_001.txt",ls="-.",colour="green")
plt.xlim(0.02,6)
plt.ylim(-1,1)
plt.ylabel(r"$\mathrm{P}_\mathrm{49} (k) / \mathrm{P}_\mathrm{99} (k) - 1$ (%)")
save_figure(path.join(outdir,"P_tot_IC_M015"))

plt.clf()
(kkb,pkb)=pmat.get_rel_folded_power("/home/spb/data/new-kspace/yacine-kspace/b256p1024nu0.3z49/powerspec_008.txt","/home/spb/data/new-kspace/yacine-kspace/b256p1024nu0z49/powerspec_008.txt")
(kks,pks)=pmat.get_rel_folded_power("/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.3z49/powerspec_008.txt","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0z49/powerspec_008.txt")
plt.semilogx(kkb,100*(pkb/pmat.rebin(pks,kks,kkb)-1),color="black", ls="-")
(kkb,pkb)=pmat.get_rel_folded_power("/home/spb/data/new-kspace/yacine-kspace/b256p1024nu0.3z49/powerspec_005.txt","/home/spb/data/new-kspace/yacine-kspace/b256p1024nu0z49/powerspec_005.txt")
(kks,pks)=pmat.get_rel_folded_power("/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.3z49/powerspec_005.txt","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0z49/powerspec_005.txt")
plt.semilogx(kkb,100*(pkb/pmat.rebin(pks,kks,kkb)-1),color="blue", ls="--")
(kkb,pkb)=pmat.get_rel_folded_power("/home/spb/data/new-kspace/yacine-kspace/b256p1024nu0.3z49/powerspec_003.txt","/home/spb/data/new-kspace/yacine-kspace/b256p1024nu0z49/powerspec_003.txt")
(kks,pks)=pmat.get_rel_folded_power("/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.3z49/powerspec_003.txt","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0z49/powerspec_003.txt")
plt.semilogx(kkb,100*(pkb/pmat.rebin(pks,kks,kkb)-1),color="grey", ls=":")
(kkb,pkb)=pmat.get_rel_folded_power("/home/spb/data/new-kspace/yacine-kspace/b256p1024nu0.3z49/powerspec_001.txt","/home/spb/data/new-kspace/yacine-kspace/b256p1024nu0z49/powerspec_001.txt")
(kks,pks)=pmat.get_rel_folded_power("/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.3z49/powerspec_001.txt","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0z49/powerspec_001.txt")
plt.semilogx(kkb,100*(pkb/pmat.rebin(pks,kks,kkb)-1),color="green", ls="-.")
plt.xlabel("k /(h Mpc-1)")
plt.xlim(0.02,6)
plt.ylim(-1,1)
plt.ylabel(r"$\mathrm{P}_\mathrm{512} (k) / \mathrm{P}_\mathrm{1024} (k) - 1$ (%)")
save_figure(path.join(outdir,"P_tot_PA_M03"))

#1D Flux power
#At z=3
plt.clf()
pflux.plot_rel_flux_power_mpc(path.join(partdir,"b60p512nu0.3z49/spectra/snap_001_flux_power.txt"),path.join(datadir,"b60p512nu0.3z49/spectra/snap_001_flux_power.txt"),60,ls=":",color="blue")
pflux.plot_rel_flux_power_mpc(path.join(partdir,"b60p512nu0.3z49/spectra/snap_006_flux_power.txt"),path.join(datadir,"b60p512nu0.3z49/spectra/snap_006_flux_power.txt"),60,ls="--",color="green")
pflux.plot_rel_flux_power_mpc(path.join(partdir,"b60p512nu0.3z49/spectra/snap_011_flux_power.txt"),path.join(datadir,"b60p512nu0.3z49/spectra/snap_011_flux_power.txt"),60,ls="-")
# pflux.plot_rel_flux_power(path.join(datadir,"b60p512nu0.3z49/spectra/snap_006_flux_power.txt"),path.join(datadir,"b60p512nu0z49/spectra/snap_006_flux_power.txt"),60,3,0.3,0.72)
plt.xlim(0.1,10)
plt.ylim(-1,1)
save_figure(path.join(outdir,"P_flux_M03"))

#At z=4
plt.clf()
pflux.plot_rel_flux_power(path.join(partdir,"b60p512nu0.3z49/spectra/snap_001_flux_power.txt"),path.join(datadir,"b60p512nu0z49/spectra/snap_001_flux_power.txt"),60,4,0.3,0.72,ls="--")
pflux.plot_rel_flux_power(path.join(datadir,"b60p512nu0.3z49/spectra/snap_001_flux_power.txt"),path.join(datadir,"b60p512nu0z49/spectra/snap_001_flux_power.txt"),60,4,0.3,0.72)
plt.xlim(1e-3,3e-1)
plt.ylim(1,1.2)
save_figure(path.join(outdir,"P_flux_M03_z4"))
#
#Hierarchy
plt.clf()
pmat.plot_rel_power_m1("/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.1z99nh/ics_matterpow_0.dat","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.1z99ih/ics_matterpow_0.dat",ls="-.",colour="orange")
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.1z99nh/powerspec_008.txt","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.1z99ih/powerspec_008.txt",ls="-",colour="black")
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.1z99nh/powerspec_005.txt","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.1z99ih/powerspec_005.txt",ls="--",colour="blue")
pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.1z99nh/powerspec_003.txt","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.1z99ih/powerspec_003.txt",ls=":",colour="grey")
# pmat.plot_rel_folded_power_m1("/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.1z99nh/powerspec_001.txt","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.1z99ih/powerspec_001.txt",ls="-.",colour="green")
# pmat.plot_rel_power_m1("/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.1z99nh/ics_matterpow_1.dat","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.1z99ih/ics_matterpow_1.dat",ls="-",colour="orange")
# pmat.plot_rel_power_m1("/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.1z99nh/ics_matterpow_3.dat","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.1z99ih/ics_matterpow_2.dat",ls="-",colour="yellow")
# pmat.plot_rel_power_m1("/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.1z99nh/ics_matterpow_9.dat","/home/spb/data/new-kspace/yacine-kspace/b256p512nu0.1z99ih/ics_matterpow_4.dat",ls="-",colour="magenta")
plt.xlim(0.02,6)
plt.ylim(-0.2,0.2)
plt.title(r"$M_\nu = 0.1$ eV")
plt.ylabel(r"$\mathrm{P}_\mathrm{IH} (k) /\mathrm{P}_\mathrm{NH} (k) -1$ (%)")
plt.tight_layout()
save_figure(path.join(outdir,"P_tot_rel_hier"))

